{"version":3,"file":"monitor.js","sources":["../../sdk/src/core/jsError.js","../../sdk/src/core/requestCatch.js","../../sdk/src/core/performance.js","../../sdk/src/index.js"],"sourcesContent":["export default {\n\tinit() {\n\t\tthis.jsError()\n\t\tthis.promiseError()\n\t},\n\t/**\n\t * 1.js运行报错\n\t * 2.资源加载报错\n\t */\n\tjsError() {\n\t\twindow.addEventListener(\n\t\t\t'error',\n\t\t\tfunction (event) {\n\t\t\t\tconsole.log(event, 'event')\n\t\t\t\t// js错误信息 静态资源加载错误信息\n\t\t\t\tif (event.target.src || event.target.link) {\n\t\t\t\t\tconsole.log('资源加载错误：', {\n\t\t\t\t\t\ttype: 'error', //小类型\n\t\t\t\t\t\terrorType: 'resourceError', //小小类型\n\t\t\t\t\t\tmessage: 'Resources load error', //报错信息\n\t\t\t\t\t\tfilename: event.target.src,\n\t\t\t\t\t\tposition: event.target.tagName,\n\t\t\t\t\t\tstack: `at ${event.target.outerHTML}`,\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('js异常：', {\n\t\t\t\t\t\ttype: 'error', //小类型\n\t\t\t\t\t\terrorType: 'jsError', //小小类型\n\t\t\t\t\t\tmessage: event.message, //报错信息\n\t\t\t\t\t\tfilename: event.filename,\n\t\t\t\t\t\tposition: `${event.lineno}:${event.colno}`,\n\t\t\t\t\t\tstack: event.error.stack,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue,\n\t\t)\n\t},\n\t/**\n\t * promise unhandledrejection报错\n\t */\n\tpromiseError() {\n\t\twindow.addEventListener(\n\t\t\t'unhandledrejection',\n\t\t\tfunction (event) {\n\t\t\t\tlet log = {\n\t\t\t\t\ttype: 'error', //小类型\n\t\t\t\t\terrorType: 'promiseError', //小小类型\n\t\t\t\t\tmessage: '', //报错信息\n\t\t\t\t\tfilename: '',\n\t\t\t\t\tposition: '',\n\t\t\t\t\tstack: '',\n\t\t\t\t}\n\t\t\t\tif (typeof event.reason === 'string') {\n\t\t\t\t\tlog.message = event.reason\n\t\t\t\t\tlog.filename = event.currentTarget.origin\n\t\t\t\t\tlog.position = `can not detect`\n\t\t\t\t\tlog.stack = 'This is a intentionally promise error by Promise.reject()'\n\t\t\t\t} else if (typeof event.reason === 'object') {\n\t\t\t\t\tlog.message = event.reason.message\n\t\t\t\t\tif (event.reason.stack) {\n\t\t\t\t\t\tlet matchResult = event.reason.stack.match(/at\\s+(.+):(\\d+):(\\d+)/)\n\t\t\t\t\t\tlog.filename = matchResult[1]\n\t\t\t\t\t\tlet line = matchResult[2],\n\t\t\t\t\t\t\tcolumn = matchResult[3]\n\t\t\t\t\t\tlog.position = `${line}:${column}`\n\t\t\t\t\t\tlog.stack = event.reason.stack\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log(log)\n\t\t\t},\n\t\t\ttrue,\n\t\t)\n\t},\n}\n","export default {\n\tinit() {\n\t\tthis.fetchReplace()\n\t\tthis.xhrReplace()\n\t},\n\txhrReplace() {\n\t\tlet xhr = window.XMLHttpRequest\n\t\t// 拦截open,send方法\n\t\tlet _open = xhr.prototype.open\n\t\txhr.prototype.open = function (method, url) {\n\t\t\tthis.logData = {\n\t\t\t\tmethod,\n\t\t\t\turl,\n\t\t\t}\n\t\t\treturn _open.apply(this, arguments)\n\t\t}\n\t\tlet _send = xhr.prototype.send\n\t\txhr.prototype.send = function (body) {\n\t\t\tlet start = Date.now()\n\t\t\tlet fn = type => () => {\n\t\t\t\tconsole.log({\n\t\t\t\t\ttype: 'xhr',\n\t\t\t\t\teventType: type,\n\t\t\t\t\tduration: Date.now() - start,\n\t\t\t\t\tstatus: this.status,\n\t\t\t\t\tresponseSize: this.responseText.length,\n\t\t\t\t\tbody,\n\t\t\t\t\t...this.logData,\n\t\t\t\t})\n\t\t\t}\n\t\t\tthis.addEventListener('load', fn('load'), false)\n\t\t\tthis.addEventListener('error', fn('error'), false)\n\t\t\tthis.addEventListener('abort', fn('abort'), false)\n\t\t\treturn _send.apply(this, arguments)\n\t\t}\n\t},\n\tfetchReplace() {\n\t\tconst _fetch = window.fetch\n\t\tconst newFetch = function (url, config) {\n\t\t\tlet start = Date.now()\n\t\t\tconst logData = {\n\t\t\t\turl,\n\t\t\t\t...config,\n\t\t\t}\n\t\t\tconst onResolve = res => {\n\t\t\t\t// 请求成功\n\t\t\t\tconsole.log({\n\t\t\t\t\tkind: 'stability',\n\t\t\t\t\ttype: 'fetch',\n\t\t\t\t\teventType: 'load',\n\t\t\t\t\tduration: Date.now() - start,\n\t\t\t\t\tstatus: res.status,\n\t\t\t\t\t...logData,\n\t\t\t\t})\n\t\t\t\treturn res\n\t\t\t}\n\t\t\tconst onReject = err => {\n\t\t\t\t// 请求失败\n\t\t\t\tconsole.log({\n\t\t\t\t\tkind: 'stability',\n\t\t\t\t\ttype: 'fetch',\n\t\t\t\t\teventType: 'error',\n\t\t\t\t\tduration: Date.now() - start,\n\t\t\t\t\tstatus: 0,\n\t\t\t\t\t...logData,\n\t\t\t\t})\n\n\t\t\t\tthrow err\n\t\t\t}\n\t\t\treturn _fetch.apply(this, arguments).then(onResolve, onReject)\n\t\t}\n\t\twindow.fetch = newFetch\n\t},\n}\n","export default {\n\tinit() {\n\t\t// 白屏时间\n\t\tthis.getFCP()\n\t\t// 最大内容绘制时间\n\t\tthis.getLCP()\n\t\t// 首次输入延迟\n\t\tthis.getFID()\n\t},\n\tgetFCP() {\n\t\tconst entryHandler = list => {\n\t\t\tfor (const entry of list.getEntries()) {\n\t\t\t\tif (entry.name === 'first-contentful-paint') {\n\t\t\t\t\tobserver.disconnect()\n\t\t\t\t\t// 计算首次内容绘制时间\n\t\t\t\t\tlet FCP = entry.startTime\n\t\t\t\t\tconsole.log('fcp', FCP)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst observer = new PerformanceObserver(entryHandler)\n\t\tobserver.observe({ type: 'paint', buffered: true })\n\t},\n\tgetLCP() {\n\t\tconst entryHandler = list => {\n\t\t\tif (observer) {\n\t\t\t\tobserver.disconnect()\n\t\t\t}\n\t\t\tfor (const entry of list.getEntries()) {\n\t\t\t\t// 最大内容绘制时间\n\t\t\t\tlet LCP = entry.startTime\n\t\t\t\tconsole.log('lcp', LCP)\n\t\t\t}\n\t\t}\n\t\tconst observer = new PerformanceObserver(entryHandler)\n\t\tobserver.observe({ type: 'largest-contentful-paint', buffered: true })\n\t},\n\tgetFID() {\n\t\tnew PerformanceObserver(entryList => {\n\t\t\tfor (const entry of entryList.getEntries()) {\n\t\t\t\t// 计算首次输入延迟时间\n\t\t\t\tconst FID = entry.processingStart - entry.startTime\n\t\t\t\tconsole.log('fid', FID)\n\t\t\t}\n\t\t}).observe({ type: 'first-input', buffered: true })\n\t},\n}\n","import jsError from './core/jsError'\nimport requestCatch from './core/requestCatch'\nimport performance from './core/performance'\nimport { version } from '../package.json'\n\nconst VERSION = version\n\nfunction init() {\n\tjsError.init()\n\trequestCatch.init()\n\tperformance.init()\n}\nexport { VERSION, init }\n"],"names":[],"mappings":"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"}